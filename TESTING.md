# AirTennis 测试指南

本文档提供详细的测试步骤和验证方法。

## 测试前准备

### 1. 硬件要求

- ✅ iPhone（任意型号，建议 iPhone 12 或更新）
- ✅ iOS 17.0 或更高版本
- ✅ Mac 电脑（用于 Xcode 开发）
- ✅ Lightning/USB-C 数据线

### 2. 软件要求

- ✅ Xcode 15.0+
- ✅ Apple Developer Account（免费账号即可）
- ✅ 已完成 [SETUP.md](./SETUP.md) 中的配置步骤

### 3. 测试环境

- 🏸 开阔空间（至少 2x2 米，避免碰到物体）
- 🤚 确保手机握持牢固（建议使用手机壳）
- ⚠️ **安全第一**：周围无易碎物品和其他人

## 测试步骤

### 阶段一：基础功能测试

#### Test 1: 传感器可用性检查

**目的**：验证设备传感器正常工作

**步骤**：
1. 在 Xcode 中打开项目
2. 连接 iPhone 并运行应用
3. 打开 Xcode 控制台
4. 查找启动日志

**预期结果**：
```
✅ Motion tracking started at 100.0Hz
```

**失败处理**：
- 如果看到 `❌ Device Motion not available`
  - 检查是否在模拟器运行（必须用真机）
  - 重启 iPhone
  - 检查 iOS 版本

---

#### Test 2: UI 界面显示

**目的**：验证所有界面正常渲染

**步骤**：
1. 启动应用
2. 检查主界面显示
3. 点击"开始训练"进入训练界面
4. 检查训练界面元素

**预期结果**：
- ✅ 主界面显示"AirTennis"标题和网球图标
- ✅ 三个按钮：开始训练、历史记录、设置
- ✅ 训练界面显示状态指示器、数据卡片、统计信息
- ✅ 无布局错误或 UI 闪烁

---

#### Test 3: 权限授予

**目的**：验证 Motion 权限正确请求

**步骤**：
1. 首次安装应用（或清除应用数据）
2. 启动应用
3. 点击"开始训练" → "开始"

**预期结果**：
- ✅ 弹出权限请求对话框
- ✅ 显示："我们需要访问运动传感器来识别您的网球挥拍动作"
- ✅ 点击"允许"后传感器开始工作

**失败处理**：
- 如果没有弹出权限请求：
  - 检查 Info.plist 配置
  - 删除应用重新安装
  - 检查设置 → 隐私 → 运动与健身

---

### 阶段二：动作识别测试

#### Test 4: 正手识别

**目的**：验证正手挥拍能被正确识别

**步骤**：
1. 进入训练模式
2. 右手握住 iPhone（就像握网球拍）
3. 做出正手击球动作（从右向左挥动）
4. 重复 5 次

**正手动作要点**：
```
起始位置：手臂在身体右侧
挥动方向：向身体左前方挥动
旋转方向：顺时针旋转（从上方看）
速度要求：自然挥拍速度，不要太慢
```

**预期结果**：
- ✅ 至少 4/5 次被识别为"正手"
- ✅ 挥拍速度 > 15 m/s
- ✅ 估算球速 > 60 km/h
- ✅ 加速度峰值 > 2.5 G
- ✅ 会话统计正确更新

**调试日志**：
```
🎾 Swing detection started
⚡️ Peak detected: 18.5 m/s
✅ Swing detected:
   Type: 正手
   Speed: 18.5 m/s
   Ball Speed: 108.8 km/h
   Acceleration: 3.42 G
🔄 Detector ready
```

---

#### Test 5: 反手识别

**目的**：验证反手挥拍能被正确识别

**步骤**：
1. 保持在训练模式
2. 右手握住 iPhone
3. 做出反手击球动作（从左向右挥动）
4. 重复 5 次

**反手动作要点**：
```
起始位置：手臂在身体左侧
挥动方向：向身体右前方挥动
旋转方向：逆时针旋转（从上方看）
速度要求：自然挥拍速度
```

**预期结果**：
- ✅ 至少 4/5 次被识别为"反手"
- ✅ 速度数据合理
- ✅ 统计计数正确

---

#### Test 6: 混合识别

**目的**：验证连续交替动作的识别准确性

**步骤**：
1. 进行以下序列：
   - 正手 x 3
   - 反手 x 3
   - 正手 x 2
   - 反手 x 2

**预期结果**：
```
会话统计:
总计: 10
正手: 5
反手: 5
平均速度: 16-22 m/s（根据个人而定）
```

---

#### Test 7: 边界情况测试

**目的**：验证系统对不规范动作的处理

| 测试场景 | 动作描述 | 预期结果 |
|---------|---------|---------|
| **太慢挥拍** | 缓慢移动手机 | ❌ 不触发检测 |
| **太快晃动** | 快速抖动手腕 | ❌ 识别为"未识别"或不触发 |
| **静止不动** | 保持手机静止 | ✅ 状态显示"准备就绪" |
| **连续快速挥拍** | 间隔 < 0.5秒的挥拍 | ✅ 冷却机制生效，不重复检测 |
| **倾斜角度过大** | pitch > 30° | ❌ 不触发检测 |

---

### 阶段三：性能测试

#### Test 8: 响应延迟

**目的**：测量从挥拍到显示结果的延迟

**步骤**：
1. 使用秒表或录像
2. 记录挥拍完成时间和数据显示时间
3. 测量 5 次取平均值

**预期结果**：
- ✅ 平均延迟 < 100ms
- ✅ UI 更新流畅，无卡顿

---

#### Test 9: 持续使用测试

**目的**：验证长时间使用的稳定性

**步骤**：
1. 连续训练 10 分钟
2. 完成至少 50 次挥拍
3. 观察应用表现

**预期结果**：
- ✅ 无崩溃
- ✅ 识别准确率保持稳定
- ✅ 内存占用正常（< 100MB）
- ✅ 电池消耗合理（< 10%/10分钟）

---

#### Test 10: 数据持久化

**目的**：验证数据正确保存和读取

**步骤**：
1. 完成一次训练会话（至少 10 次挥拍）
2. 点击"停止"
3. 关闭应用（完全退出）
4. 重新打开应用
5. 点击"历史记录"

**预期结果**：
- ✅ 历史记录显示之前的挥拍数据
- ✅ 数据准确（类型、速度、时间戳）
- ✅ 可以查看每条记录详情

---

### 阶段四：用户体验测试

#### Test 11: 新用户首次使用

**目的**：模拟新用户的首次体验

**步骤**：
1. 找一个从未见过应用的人
2. 让他们尝试使用（不提供任何指导）
3. 观察他们的操作流程和困惑点

**评估标准**：
- ✅ 能在 30 秒内理解如何开始训练
- ✅ 能成功完成至少 1 次挥拍检测
- ✅ 理解显示的数据含义

---

#### Test 12: 可用性测试

**测试清单**：
- [ ] 按钮文字清晰易懂
- [ ] 数据单位明确（m/s, km/h, G）
- [ ] 状态指示器易于理解
- [ ] 统计数字准确
- [ ] 界面在不同 iPhone 尺寸上正常显示

---

## 性能基准

### 识别准确率目标

| 指标 | 目标值 | 当前值 | 状态 |
|------|-------|-------|------|
| 正手识别率 | > 85% | ___% | ⏳ 待测试 |
| 反手识别率 | > 85% | ___% | ⏳ 待测试 |
| 误报率 | < 10% | ___% | ⏳ 待测试 |
| 响应延迟 | < 100ms | ___ms | ⏳ 待测试 |

### 性能指标目标

| 指标 | 目标值 | 当前值 | 状态 |
|------|-------|-------|------|
| 内存占用 | < 100MB | ___MB | ⏳ 待测试 |
| CPU 使用率 | < 30% | ___% | ⏳ 待测试 |
| 电池消耗 | > 2小时连续使用 | ___小时 | ⏳ 待测试 |
| 帧率 | > 30fps | ___fps | ⏳ 待测试 |

---

## 常见问题排查

### 问题 1: 检测不到挥拍

**症状**：挥拍后没有任何反应

**检查清单**：
- [ ] 是否在真机上运行？（模拟器不支持）
- [ ] 是否点击了"开始"按钮？
- [ ] 挥拍动作是否足够大？
- [ ] 查看 Xcode 控制台日志

**解决方案**：
```swift
// 在 SwingDetector.swift 中降低阈值
private let accelerationThreshold: Double = 2.0  // 从 2.5 降到 2.0
```

---

### 问题 2: 识别类型错误

**症状**：正手被识别为反手，或反之

**原因**：
1. 握持方向不对
2. 左撇子用户
3. 阈值设置不合理

**解决方案**：
```swift
// 对于左撇子用户，在 SwingDetector.swift 中调整
// 交换正手和反手的判断逻辑
```

---

### 问题 3: 速度值异常

**症状**：速度显示 0 或异常高的值

**检查**：
- 手臂长度设置（默认 0.65m）
- 计算公式是否正确

**调试**：
```swift
// 在 SpeedCalculator.swift 中添加日志
print("Angular velocity: \(angularVelocity) rad/s")
print("Arm length: \(length) m")
print("Linear speed: \(angularVelocity * length) m/s")
```

---

## 测试报告模板

```markdown
# AirTennis 测试报告

**测试日期**：2025-11-05
**测试设备**：iPhone 14 Pro (iOS 17.1)
**测试人员**：[姓名]

## 测试结果摘要

- ✅ 传感器功能正常
- ✅ UI 界面显示正确
- ⚠️ 正手识别率：78%（低于目标 85%）
- ✅ 反手识别率：88%
- ✅ 数据持久化正常

## 发现的问题

1. **问题描述**：正手识别率偏低
   - **严重程度**：中
   - **重现步骤**：缓慢挥拍时经常无法触发
   - **建议**：降低加速度阈值到 2.0G

2. **问题描述**：...

## 性能数据

- 平均响应延迟：65ms
- 内存占用：72MB
- 10分钟电池消耗：8%

## 改进建议

1. 降低检测阈值
2. 添加视觉反馈帮助用户理解何时触发检测
3. ...

```

---

## 下一步

完成测试后：

1. 填写测试报告
2. 记录性能数据
3. 调整参数优化准确率
4. 收集用户反馈
5. 规划下一版本功能

---

**祝测试顺利！🎾**
